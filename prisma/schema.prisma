generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}

model User {
  id           			String    @id @default(cuid())
  createdAt 		  DateTime     @default(now())
  updatedAt 		  DateTime     @updatedAt
  username     			String    @unique
  fullName          String
  email        			String    @unique
  emailVerified     		Boolean   @default(false)
  isAdmin           Boolean   @default(false)
  isSuperAdmin      Boolean   @default(false)
  sidebarOrder      String?
  passwordHash 			String
  sessions     			Session[]
  passwordResetTokens     	PasswordResetToken[]
  emailVerificationTokens 	EmailVerificationToken[]
  blogs                Blog[]
  attachmentId     String?    @unique
  attachment       Attachment? @relation("UserAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)
  schedulePosts       SchedulePost[]
 
  }

model Client {
  id          	 	String    @id @default(cuid())
  createdAt 		  DateTime     @default(now())
  updatedAt 		  DateTime     @updatedAt
  firstName    		String
  lastName     		String
  email            String?
  telephone    		String	@unique
  address      		String
  appointments  	Appointment[]   
  messages     		Message[] 
  status      		ClientStatus @default(PROSPECT)
  attachmentId     String?    @unique
  attachment       Attachment? @relation("ClientAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)
  Testimonials     Testimonial[]
  invoices         Invoice[]

}


model Session {
  id        		String   @id
  expiresAt 		DateTime
  userId    		String
  user      		User     @relation(references: [id], fields: [userId], onDelete: Cascade)
  @@index([userId])
}

model PasswordResetToken {
  tokenHash 		String   @unique
  expiresAt 		DateTime
  userId    		String
  user      		User     @relation(references: [id], fields: [userId], onDelete: Cascade)

  @@index([userId])
}

model EmailVerificationToken {
  id        		String   @id @default(cuid())
  createdAt 		DateTime @default(now())
  code      		String
  expiresAt 		DateTime
  email     		String
  userId    		String
  user      		User     @relation(references: [id], fields: [userId], onDelete: Cascade)

  @@index([userId])
}

model Attachment {
  id   		          String @id @default(cuid())
  createdAt 		    DateTime     @default(now())
  updatedAt 		    DateTime     @updatedAt
  name 		          String
  attachmentType     AttachmentType
  blog              Blog?        @relation("BlogAttachment")
  schedulePost      SchedulePost? @relation("SchedulePostAttachment")
  clinic            Clinic?      @relation("ClinicAttachment")
  doctor            Doctor?      @relation("DoctorAttachment")
  user              User?        @relation("UserAttachment")
  client            Client?      @relation("ClientAttachment")
  invoice           Invoice?     @relation("InvoiceAttachment")
  }


model Invoice {
  id             String        @id @default(cuid())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  invoiceNumber  String        @unique
  status         InvoiceStatus @default(DRAFT)
  issueDate      DateTime
  dueDate        DateTime
  currency       String        @default("NGN")
  subtotal       Decimal       @db.Decimal(12, 2)
  tax            Decimal       @db.Decimal(12, 2) @default(0)
  discount       Decimal       @db.Decimal(12, 2) @default(0)
  total          Decimal       @db.Decimal(12, 2)
  notes          String?       @db.VarChar(2000)
  terms          String?       @db.VarChar(2000)
  sentAt         DateTime?
  paidAt         DateTime?

  clientId       String
  client         Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)

  attachmentId   String?       @unique
  attachment     Attachment?   @relation("InvoiceAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)

  items          InvoiceItem[]

  @@index([clientId])
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  description String
  quantity    Int
  unitPrice   Decimal  @db.Decimal(12, 2)
  amount      Decimal  @db.Decimal(12, 2)

  @@index([invoiceId])
}

model Blog {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  title         String
  tags          String
  content       String   @db.VarChar(2000)
  authorId      String
  author        User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  attachmentId  String   @unique
  attachment    Attachment @relation("BlogAttachment", fields: [attachmentId], references: [id], onDelete: Cascade)
  

  @@index([authorId])
}

model SchedulePost {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  title         String
  tags          String
  content       String   @db.VarChar(2000)
  scheduledFor  DateTime
  authorId      String
  author        User     @relation(fields: [authorId], references: [id], onDelete: SetNull)
  attachmentId  String?   @unique
  attachment    Attachment? @relation("SchedulePostAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)

  @@index([authorId])
  @@index([scheduledFor])
}

model Appointment {
  id        		String       @id @default(cuid())
  createdAt 		DateTime     @default(now())
  updatedAt 		DateTime     @updatedAt
  setDay        DateTime
  setTime   		String
  status    		AppointmentStatus @default(BOOKED)
  client    		Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId  		String
  clinic   		  Clinic 	 @relation(fields: [clinicId], references: [id], onDelete: SetNull)  
  clinicId  		String    
  doctorId		  String?
  doctor 		    Doctor?  @relation(fields: [doctorId], references: [id], onDelete: SetNull)
  //schedule       ClinicSchedule  @relation(fields: [clinicScheduleId], references: [id], onDelete: Cascade)
  clinicScheduleId   String?
  @@index([clientId])
  //@@index([doctorId])
  //@@index([clinicId])
}

model ClinicSchedule {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  date      DateTime
  startShift String  @map("start_shift") @db.VarChar(5)
  endShift   String  @map("end_shift") @db.VarChar(5)
  clinic    Clinic   @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  clinicId  String
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  doctorId  String

  @@index([clinicId])
  @@index([doctorId])
  @@index([clinicId, date])
}

model Clinic {
  id	    	    String       	@id @default(cuid())
  createdAt 		  DateTime     @default(now())
  updatedAt 		  DateTime     @updatedAt
  name	        String	 	@unique
  desc	  	    String
  doctors    ClinicSchedule[]
  operatingTimes OperatingTime[]
  //doctors       Doctor[]
  appointments  Appointment[]
  attachmentId     String?   @unique
  attachment       Attachment? @relation("ClinicAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)


}

model OperatingTime {
  id        String        @id @default(cuid())
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  openDay   OperatingDay
  startTime String        @map("start_time") @db.VarChar(5)
  endTime   String        @map("end_time") @db.VarChar(5)
  clinic    Clinic        @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  clinicId  String

  @@index([clinicId])
}

model Doctor {
  id     	String    @id @default(cuid())
  firstName   	String
  lastName    	String
  email       	String
  createdAt 		  DateTime     @default(now())
  updatedAt 		  DateTime     @updatedAt
  //clinicId	     String?
  //clinic         Clinic?		@relation(fields: [clinicId], references: [id], onDelete: Cascade)
  appointments  Appointment[]
  clinics	    ClinicSchedule[]
  attachmentId   String?   @unique
  attachment     Attachment? @relation("DoctorAttachment", fields: [attachmentId], references: [id], onDelete: SetNull)
  
}
     

model Testimonial {
  id   		      String   @id @default(cuid())
  createdAt 		DateTime     @default(now())
  updatedAt 		DateTime     @updatedAt
  client 	       Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId    	String
  content  	    String   @db.VarChar(300)
}

model Message {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  content   String   @db.VarChar(1024)
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId  String
  

  @@index([clientId])
}
model Campaigns {
  id	String    @id @default(cuid())
  createdAt 		  DateTime     @default(now())
  updatedAt 		  DateTime     @updatedAt
  name 	String
  catchphrase   String
  startDate DateTime
  endDate   DateTime

}

enum ClientStatus {
  PROSPECT
  PATIENT 
}
enum AppointmentStatus {
  BOOKED
  CONFIRMED
  ARRIVED
  InPROGRESS
  FULFILLED
  CANCELLED
  MISSED
}

enum OperatingDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}
enum AttachmentType {
  CLIENT          
  ADMIN
  DOCTOR     
  BLOG
  CLINIC
  USER
  SCHEDULE_POST
  INVOICE
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
}
